# 優良株情報取得ツール ユーザーマニュアル

## 目次

1. [はじめに](#1-はじめに)
2. [画面構成](#2-画面構成)
3. [おすすめ銘柄（トップページ）](#3-おすすめ銘柄トップページ)
4. [銘柄一覧・シグナル](#4-銘柄一覧シグナル)
5. [銘柄詳細](#5-銘柄詳細)
6. [ポートフォリオ](#6-ポートフォリオ)
7. [取引履歴](#7-取引履歴)
8. [設定](#8-設定)
9. [シグナル判定の仕組み](#9-シグナル判定の仕組み)
10. [データ更新タイミング](#10-データ更新タイミング)
11. [セットアップ手順](#11-セットアップ手順)
12. [デプロイ](#12-デプロイ)
13. [API リファレンス](#13-api-リファレンス)
14. [トラブルシューティング](#14-トラブルシューティング)

---

## 1. はじめに

### 概要

「優良株情報取得ツール」は、日本株の株価情報を定期的に取得し、テクニカル指標（RSI・MACD・移動平均線）に基づいて**買い時・売り時のシグナル**を自動判定するWebアプリケーションです。

### 主な機能

- 日本株の監視登録（最大20銘柄）
- テクニカル指標に基づく売買シグナルの自動判定
- シグナル強度（1〜3段階）と目標価格の表示
- 投資予算に応じたおすすめ銘柄の提案
- 株価チャートとテクニカル指標の可視化
- 取引記録とポートフォリオ管理（損益計算）
- 平日3回の自動データ更新（9:30 / 12:30 / 15:30）

### 対応銘柄

以下の主要20銘柄に対応しています:

| コード | 銘柄名 | コード | 銘柄名 |
|--------|--------|--------|--------|
| 7203 | トヨタ自動車 | 6758 | ソニーグループ |
| 9984 | ソフトバンクグループ | 8306 | 三菱UFJフィナンシャル |
| 9432 | 日本電信電話(NTT) | 6861 | キーエンス |
| 7974 | 任天堂 | 4063 | 信越化学工業 |
| 6098 | リクルートHD | 8035 | 東京エレクトロン |
| 6501 | 日立製作所 | 6902 | デンソー |
| 8058 | 三菱商事 | 6367 | ダイキン工業 |
| 9433 | KDDI | 4519 | 中外製薬 |
| 6594 | 日本電産 | 7741 | HOYA |
| 3382 | セブン&アイHD | 4661 | オリエンタルランド |

---

## 2. 画面構成

アプリは6つの画面で構成されています。画面下部のナビゲーションバーから各画面に移動できます。

| 画面 | パス | 説明 |
|------|------|------|
| おすすめ銘柄 | `/` | 投資予算に応じた売買おすすめを表示 |
| 銘柄一覧 | `/signals` | 監視中の全銘柄とシグナル一覧 |
| 銘柄詳細 | `/stock/:code` | 個別銘柄のチャートと詳細分析 |
| ポートフォリオ | `/portfolio` | 保有銘柄と損益の確認 |
| 取引履歴 | `/history` | 過去の売買記録の一覧 |
| 設定 | `/settings` | シグナル判定の閾値を調整 |

---

## 3. おすすめ銘柄（トップページ）

アプリ起動時に表示されるメイン画面です。

### 投資予算の設定

画面上部で投資予算を設定します。プリセット金額から選択するか、カスタム金額を入力できます。

**プリセット金額:**
- 5万円 / 10万円 / 30万円 / 50万円 / 100万円

予算を変更すると、購入可能数量や投資金額が自動で再計算されます。

### 買いおすすめカード

買いシグナルが出ている銘柄が表示されます。各カードには以下の情報が含まれます:

- **銘柄コードと名前**
- **シグナル強度**: 星マーク（★）1〜3個で表示。多いほど強いシグナル
- **発生中のシグナル**: RSI / MACD / ゴールデンクロスのうち該当するもの
- **現在の株価**
- **目標株価**: テクニカル分析に基づく上昇目標
- **期待利益**: (目標株価 - 現在株価) × 購入数量
- **損切りライン**: リスク管理のための下限価格
- **購入提案**: 予算内で購入可能な数量と合計金額

### 売りおすすめカード

売りシグナルが出ている銘柄が表示されます。保有中の銘柄に売りシグナルが出ている場合の参考になります。

---

## 4. 銘柄一覧・シグナル

監視中の全銘柄をカード形式で一覧表示します。

### 銘柄の追加

1. 画面右下の「＋」ボタンをタップ
2. 4桁の銘柄コードを入力（例: `7203`）
3. 「追加」をタップ
4. システムがyfinanceからデータを取得し、テクニカル指標を計算
5. 一覧に銘柄が追加される

### 銘柄カードの見方

各カードには以下が表示されます:

- **銘柄コード・名前**
- **現在の株価と前日比（%）**
- **シグナルチップ**:
  - 🟢 緑 = 買いシグナル
  - 🔴 赤 = 売りシグナル
  - ⚪ グレー = 様子見（ホールド）
- **シグナル強度**: 星マーク（1〜3個）

### データの手動更新

画面上部の更新ボタンをタップすると、全銘柄の最新データを取得・再計算します。

### 銘柄の削除

銘柄カードの削除ボタンをタップすると、確認後に監視リストから削除されます。

---

## 5. 銘柄詳細

銘柄一覧でカードをタップすると詳細画面に遷移します。

### ヘッダー情報

- 銘柄コード・名前
- 現在の株価
- 前日比（金額と%）
- シグナルチップとシグナル強度

### 売買ガイドライン

シグナルの種類に応じて以下が表示されます:

**買いシグナル時:**
- **目標株価**: 利益確定の目安
- **損切りライン**: 下落時の撤退目安
- **サポートライン**: 直近25日間の安値
- **レジスタンスライン**: 直近25日間の高値
- **発生中のシグナル一覧**

**売りシグナル時:**
- **目標株価（下値）**: 下落目標
- **損切りライン（上値）**: 逆行時の撤退目安

### 株価チャート

終値と移動平均線（5日・25日）を折れ線グラフで表示します。

**表示期間の切り替え:**
- 1M（1ヶ月）
- 3M（3ヶ月）
- 6M（6ヶ月）
- 1Y（1年）

### テクニカル指標

- **RSI（14日）**: 0〜100の数値。30以下で売られすぎ、70以上で買われすぎ
- **MACD**: MACDラインとシグナルラインの数値。MACDがシグナルを上回ると上昇トレンド
- **移動平均線**: 5日（短期）・25日（中期）・75日（長期）の各価格

---

## 6. ポートフォリオ

保有銘柄の一覧と損益を管理します。

### サマリーカード

画面上部に以下の合計値が表示されます:

- **評価額合計**: 保有全銘柄の現在の時価総額
- **取得金額合計**: 購入時の合計コスト
- **損益合計**: 評価額 - 取得金額（円とパーセント）
  - プラスの場合: 緑色で表示
  - マイナスの場合: ピンク色で表示

### 保有銘柄リスト

銘柄ごとに以下が表示されます:

- 銘柄コード・名前
- 保有数量
- 平均取得単価
- 現在の評価額
- 損益（円と%）

### 取引の記録

1. 画面右下の「＋」ボタンをタップ
2. 取引種別を選択（買い / 売り）
3. 銘柄コード（4桁）を入力
4. 数量と1株あたりの価格を入力
5. メモ（任意）を入力
6. 「記録」をタップ

---

## 7. 取引履歴

過去の全取引をリスト形式で表示します。

### 表示内容

各取引には以下が表示されます:

- **取引種別バッジ**: 買い（緑）/ 売り（赤）
- **銘柄コードと名前**
- **数量 × 単価 = 合計金額**
- **取引日時**
- **メモ**（入力した場合）

### 取引の削除

各取引の削除ボタンをタップすると、確認ダイアログの後に削除されます。

---

## 8. 設定

シグナル判定に使用するパラメータを調整できます。

### RSI 閾値

| 項目 | 範囲 | デフォルト | 説明 |
|------|------|------------|------|
| 買いシグナル閾値 | 10〜50 | 30 | この値以下で「売られすぎ」と判定 |
| 売りシグナル閾値 | 50〜90 | 70 | この値以上で「買われすぎ」と判定 |

- 買い閾値を**下げる** → より厳選された買いシグナル（慎重な投資）
- 売り閾値を**上げる** → より長くホールド（利益追求型）

### 移動平均線の期間

| 項目 | 範囲 | デフォルト | 説明 |
|------|------|------------|------|
| 短期移動平均 | 1〜50日 | 5日 | ゴールデンクロス/デッドクロスの短期線 |
| 中期移動平均 | 10〜100日 | 25日 | ゴールデンクロス/デッドクロスの中期線 |
| 長期移動平均 | 50〜200日 | 75日 | 長期トレンドの参考値 |

### 投資予算

- プリセットから選択するか、カスタム金額を入力
- 最低金額: 10,000円
- この設定はおすすめ銘柄ページの購入提案に反映されます

### 操作

- **保存**: 現在の設定をデータベースに保存
- **デフォルトに戻す**: 全項目を初期値にリセット

---

## 9. シグナル判定の仕組み

### 買いシグナルの条件

以下のいずれか1つ以上が成立すると買いシグナルが発生します:

| シグナル | 条件 | 意味 |
|----------|------|------|
| RSI | RSI ≦ 30 | 株価が売られすぎの水準にある |
| MACDクロス | MACD > シグナルライン に転換 | 上昇トレンドへの転換を示唆 |
| ゴールデンクロス | 短期MA > 中期MA に転換 | 短期的な上昇トレンドの始まり |

### 売りシグナルの条件

以下のいずれか1つ以上が成立すると売りシグナルが発生します:

| シグナル | 条件 | 意味 |
|----------|------|------|
| RSI | RSI ≧ 70 | 株価が買われすぎの水準にある |
| MACDクロス | MACD < シグナルライン に転換 | 下降トレンドへの転換を示唆 |
| デッドクロス | 短期MA < 中期MA に転換 | 短期的な下降トレンドの始まり |

### シグナル強度

該当するシグナルの数に応じて強度が決まります:

| 強度 | 該当数 | 表示 | 信頼度 |
|------|--------|------|--------|
| 1 | 1つ | ★☆☆ | 参考程度 |
| 2 | 2つ | ★★☆ | やや強い |
| 3 | 3つ | ★★★ | 非常に強い |

### 目標価格の算出ロジック

**買いシグナル時:**
- **目標株価** = 以下の最大値
  - レジスタンスライン（25日間の高値）
  - 75日移動平均（現在価格を上回る場合）
  - 現在株価 × 1.10（10%上昇）
- **損切りライン** = 以下の最大値
  - サポートライン（25日間の安値）
  - 現在株価 × 0.95（5%下落）

**売りシグナル時:**
- **目標株価（下値）** = サポートライン（25日間の安値）
- **損切りライン（上値）** = レジスタンスライン（25日間の高値）

---

## 10. データ更新タイミング

### 自動更新

平日（月〜金）の以下の時刻に自動更新が実行されます:

| 時刻 | タイミング |
|------|-----------|
| 09:30 | 東証の前場開始後 |
| 12:30 | 後場開始後 |
| 15:30 | 取引終了後 |

更新処理の内容:
1. 監視中の全銘柄の最新株価データを取得
2. テクニカル指標（RSI・MACD・移動平均線）を再計算
3. シグナル判定を実行
4. 目標価格・サポート/レジスタンスラインを更新

### 手動更新

銘柄一覧画面の更新ボタンから、任意のタイミングでデータ更新を実行できます。

---

## 11. セットアップ手順

### 前提条件

- Node.js 18以上
- Python 3.11以上
- PostgreSQL データベース（Neon推奨）

### バックエンド

```bash
cd backend

# 依存パッケージのインストール
pip install -r requirements.txt

# 環境変数の設定（.env.local を作成）
# DATABASE_URL=postgresql://user:pass@host/dbname
# CORS_ORIGINS=http://localhost:3847

# サーバー起動
uvicorn src.main:app --host 0.0.0.0 --port 8734 --reload
```

### フロントエンド

```bash
cd frontend

# 依存パッケージのインストール
npm install

# 環境変数の設定（.env.local を作成）
# VITE_API_URL=http://localhost:8734

# 開発サーバー起動
npm run dev
```

ブラウザで `http://localhost:3847` にアクセスして利用開始できます。

### 環境変数一覧

**バックエンド（backend/.env.local）:**

| 変数名 | 必須 | 説明 | 例 |
|--------|------|------|-----|
| DATABASE_URL | Yes | PostgreSQL接続文字列 | `postgresql://user:pass@host/db` |
| CORS_ORIGINS | Yes | フロントエンドのオリジン | `http://localhost:3847` |
| MOCK_MODE | No | モックデータ使用 | `true`（デフォルト: true） |

**フロントエンド（frontend/.env.local）:**

| 変数名 | 必須 | 説明 | 例 |
|--------|------|------|-----|
| VITE_API_URL | Yes | バックエンドAPIのURL | `http://localhost:8734` |

---

## 12. デプロイ

### フロントエンド → Vercel

1. GitHubリポジトリをVercelに接続
2. フレームワーク: Vite を選択
3. ルートディレクトリ: `frontend`
4. 環境変数を設定:
   - `VITE_API_URL` = バックエンドの本番URL

### バックエンド → Render / Railway

1. GitHubリポジトリを接続
2. ルートディレクトリ: `backend`
3. ビルドコマンド: `pip install -r requirements.txt`
4. 起動コマンド: `uvicorn src.main:app --host 0.0.0.0 --port 8734`
5. 環境変数を設定:
   - `DATABASE_URL` = PostgreSQL接続文字列
   - `CORS_ORIGINS` = フロントエンドの本番URL
   - `MOCK_MODE` = `false`

---

## 13. API リファレンス

ベースURL: `http://localhost:8734/api`

### ヘルスチェック

```
GET /api/health
```

レスポンス: `{ "status": "ok" }`

### 銘柄管理

```
GET    /api/stocks              # 全銘柄の一覧（シグナル付き）
POST   /api/stocks              # 銘柄を追加（Body: { "code": "7203" }）
DELETE /api/stocks/{code}       # 銘柄を削除
GET    /api/stocks/{code}       # 銘柄の詳細情報
GET    /api/stocks/{code}/chart # チャートデータ（?period=3m）
```

**チャートの期間パラメータ:** `1m` / `3m` / `6m` / `1y`

### おすすめ

```
GET /api/recommendations        # 買い/売りおすすめ一覧
```

### データ更新

```
POST /api/update                # 全銘柄のデータを手動更新
```

### 設定

```
GET /api/settings               # 現在の設定を取得
PUT /api/settings               # 設定を更新（部分更新可能）
```

設定の更新例:
```json
{
  "rsiBuyThreshold": 25,
  "rsiSellThreshold": 75,
  "smaShortPeriod": 5,
  "smaMidPeriod": 25,
  "smaLongPeriod": 75,
  "investmentBudget": 300000
}
```

### 取引

```
GET    /api/transactions            # 取引履歴一覧
POST   /api/transactions            # 取引を記録
DELETE /api/transactions/{id}       # 取引を削除
GET    /api/transactions/portfolio  # ポートフォリオ（保有・損益）
```

取引の記録例:
```json
{
  "code": "7203",
  "transaction_type": "buy",
  "quantity": 100,
  "price": 3000,
  "memo": "買いシグナル★★★で購入"
}
```

---

## 14. トラブルシューティング

### よくある問題

**Q: 銘柄を追加してもデータが表示されない**
- yfinanceからのデータ取得に数秒かかる場合があります。しばらく待ってから画面を更新してください。
- バックエンドのログでエラーが出ていないか確認してください。

**Q: シグナルが「様子見」ばかりになる**
- テクニカル指標の計算には一定量の過去データが必要です。銘柄追加直後は十分なデータが揃っていない可能性があります。
- 設定画面でRSI閾値を調整してみてください（買い閾値を上げる / 売り閾値を下げる）。

**Q: チャートが表示されない**
- 銘柄追加後にデータ更新が完了していることを確認してください。
- ブラウザのコンソールでAPIエラーが出ていないか確認してください。

**Q: ポートフォリオの損益がおかしい**
- 取引履歴で重複した記録がないか確認してください。
- 売り取引の数量が保有数量を超えていないか確認してください。

**Q: フロントエンドからバックエンドに接続できない**
- バックエンドが起動しているか確認してください。
- `CORS_ORIGINS` にフロントエンドのURLが正しく設定されているか確認してください。
- `VITE_API_URL` がバックエンドのURLと一致しているか確認してください。

---

## 免責事項

本ツールが提供するシグナルや推奨情報は、テクニカル指標に基づく参考情報であり、投資助言ではありません。投資判断は自己責任で行ってください。株式投資にはリスクが伴い、元本割れの可能性があります。
