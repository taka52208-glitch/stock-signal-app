# 要件定義書: 優良株情報取得ツール

## 1. プロジェクト概要

### 1.1 成果目標
日本株の株価情報を1日数回自動取得し、テクニカル指標に基づいて買い時・売り時シグナルを判定。スマホ対応のWebアプリで個人利用する。

### 1.2 成功指標

#### 定量的指標
- 1日3〜5回の自動情報更新
- 最大20銘柄程度を監視可能
- スマホ・PC両対応（レスポンシブ）

#### 定性的指標
- 外出先でもスマホでサッと確認できる
- 売買判断の根拠が一目で分かる
- 相場を常に見張らなくて良い安心感

---

## 2. システム全体像

### 2.1 機能一覧

| 機能 | 説明 |
|------|------|
| 銘柄登録・削除 | 監視したい銘柄を追加・削除 |
| 株価データ取得 | yfinanceから日足データを定期取得 |
| テクニカル指標計算 | RSI, MACD, 移動平均線を計算 |
| シグナル判定 | 買い/売り/様子見のシグナルを自動判定 |
| 一覧表示 | 全銘柄の現在状況を一覧表示 |
| 詳細表示 | 個別銘柄のチャート・指標詳細を表示 |
| 設定変更 | シグナル判定条件のカスタマイズ |

### 2.2 ユーザーロール
- **利用者**: 1名（個人利用）
- **認証**: なし（URLを知っている人のみアクセス）

### 2.3 データ保存
- サーバー側（PostgreSQL）に保存
- どの端末からも同じ銘柄リストを閲覧可能

---

## 3. ページ詳細仕様

### P-001: 銘柄一覧（メイン）

| 項目 | 内容 |
|------|------|
| ページID | P-001 |
| ルート | `/` |
| 目的 | 監視銘柄の状況を一目で把握 |
| 優先度 | 高 |

#### 機能
- 監視銘柄のリスト表示
- 各銘柄の現在株価・前日比・シグナル表示
- 銘柄追加ボタン（モーダルで銘柄コード入力）
- 銘柄削除ボタン（スワイプまたは長押し）
- プルダウンで手動更新
- 最終更新日時の表示

#### シグナル表示
- 🟢 **買い**: 緑色で表示
- 🔴 **売り**: 赤色で表示
- ⚪ **様子見**: グレーで表示

#### 処理フロー
1. ページ読み込み時にAPIから銘柄一覧を取得
2. 各銘柄の最新株価・シグナルを表示
3. 銘柄タップで詳細画面へ遷移

---

### P-002: 銘柄詳細

| 項目 | 内容 |
|------|------|
| ページID | P-002 |
| ルート | `/stock/:code` |
| 目的 | 個別銘柄の詳細分析 |
| 優先度 | 高 |

#### 機能
- 銘柄名・現在株価・前日比の表示
- 株価チャート表示（過去3ヶ月程度）
- テクニカル指標の表示
  - RSI（数値 + ゲージ）
  - MACD（MACDライン、シグナルライン、ヒストグラム）
  - 移動平均線（5日、25日、75日）
- シグナル判定の根拠表示
- 一覧画面への戻るボタン

#### 処理フロー
1. URLパラメータから銘柄コードを取得
2. APIから該当銘柄の詳細データを取得
3. チャート・指標を描画

---

### P-003: 設定

| 項目 | 内容 |
|------|------|
| ページID | P-003 |
| ルート | `/settings` |
| 目的 | シグナル条件のカスタマイズ |
| 優先度 | 中 |

#### 機能
- RSI閾値設定（買い: デフォルト30以下、売り: デフォルト70以上）
- 移動平均期間設定（短期/中期/長期の日数）
- 設定保存ボタン
- デフォルトに戻すボタン

#### 処理フロー
1. 現在の設定値を取得・表示
2. ユーザーが値を変更
3. 保存ボタンで設定をAPIに送信

---

## 4. データ設計概要

### 4.1 エンティティ

#### stocks（監視銘柄）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | SERIAL | 主キー |
| code | VARCHAR(10) | 銘柄コード（例: 7203） |
| name | VARCHAR(100) | 銘柄名（例: トヨタ自動車） |
| created_at | TIMESTAMP | 登録日時 |

#### stock_prices（株価データ）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | SERIAL | 主キー |
| code | VARCHAR(10) | 銘柄コード |
| date | DATE | 日付 |
| open | DECIMAL | 始値 |
| high | DECIMAL | 高値 |
| low | DECIMAL | 安値 |
| close | DECIMAL | 終値 |
| volume | BIGINT | 出来高 |

#### signals（シグナル履歴）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | SERIAL | 主キー |
| code | VARCHAR(10) | 銘柄コード |
| date | DATE | 日付 |
| signal_type | VARCHAR(10) | buy / sell / hold |
| rsi | DECIMAL | RSI値 |
| macd | DECIMAL | MACD値 |
| macd_signal | DECIMAL | MACDシグナル値 |

#### settings（設定）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | SERIAL | 主キー |
| key | VARCHAR(50) | 設定キー |
| value | VARCHAR(100) | 設定値 |

### 4.2 バリデーション
- 銘柄コード: 4桁の数字
- RSI閾値: 0〜100の範囲
- 移動平均期間: 1〜200の範囲

---

## 5. シグナル判定ロジック

### 5.1 買いシグナル（いずれかを満たす場合）
- RSI が 30 以下（売られすぎ）
- ゴールデンクロス発生（短期MAが中期MAを上抜け）
- MACD がシグナルラインを上抜け

### 5.2 売りシグナル（いずれかを満たす場合）
- RSI が 70 以上（買われすぎ）
- デッドクロス発生（短期MAが中期MAを下抜け）
- MACD がシグナルラインを下抜け

### 5.3 様子見
- 上記のいずれにも該当しない場合

---

## 6. セキュリティ要件

### 6.1 必須対応
- ヘルスチェックエンドポイント: `/api/health`
- グレースフルシャットダウン: SIGTERM対応、8秒タイムアウト
- HTTPS強制（本番環境）
- 入力値サニタイゼーション（銘柄コード等）

### 6.2 API保護
- 認証は不要だが、Rate Limit を設定（1分あたり60リクエスト）
- CORS設定（フロントエンドドメインのみ許可）

---

## 7. 技術スタック

### 7.1 フロントエンド
| 技術 | バージョン | 用途 |
|------|-----------|------|
| React | 18.x | UIフレームワーク |
| TypeScript | 5.x | 型安全性 |
| Vite | 5.x | ビルドツール |
| MUI | 6.x | UIコンポーネント |
| React Router | 6.x | ルーティング |
| Zustand | 4.x | 状態管理 |
| React Query | 5.x | データフェッチング |
| Recharts | 2.x | チャート描画 |

### 7.2 バックエンド
| 技術 | バージョン | 用途 |
|------|-----------|------|
| Python | 3.11 | 言語 |
| FastAPI | 0.100+ | APIフレームワーク |
| yfinance | 最新 | 株価データ取得 |
| pandas-ta | 最新 | テクニカル指標計算 |
| APScheduler | 3.x | 定期実行 |
| SQLAlchemy | 2.x | ORM |
| Pydantic | 2.x | バリデーション |

### 7.3 データベース
| 技術 | 用途 |
|------|------|
| PostgreSQL | メインDB |
| Neon | サーバーレスPostgreSQL（無料枠） |

### 7.4 インフラ
| サービス | 用途 |
|----------|------|
| Vercel | フロントエンドホスティング |
| Render / Railway | バックエンドホスティング |

---

## 8. 外部サービス一覧

| サービス | 用途 | 費用 |
|----------|------|------|
| yfinance | 株価データ取得 | 無料 |
| Neon | PostgreSQLホスティング | 無料枠 |
| Vercel | フロントエンドホスティング | 無料 |
| Render | バックエンドホスティング | 無料枠 |

---

## 9. 定期更新スケジュール

| 時刻 | 処理内容 |
|------|----------|
| 09:30 | 市場開始後の株価取得・シグナル判定 |
| 12:30 | 昼休み中の株価取得・シグナル判定 |
| 15:30 | 市場終了後の株価取得・シグナル判定 |

※ 土日祝日は実行しない（市場休場）

---

## 10. 非機能要件

### 10.1 パフォーマンス
- ページ読み込み: 3秒以内
- API応答: 500ms以内

### 10.2 可用性
- 個人利用のため、99%程度の稼働率で十分

### 10.3 スケーラビリティ
- 監視銘柄: 最大20銘柄
- 同時アクセス: 1名（個人利用）
